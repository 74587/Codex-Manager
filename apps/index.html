<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>CodexManager</title>
        <link rel="stylesheet" href="/src/styles/base.css" />
        <link rel="stylesheet" href="/src/styles/layout.css" />
        <link rel="stylesheet" href="/src/styles/components.css" />
        <link rel="stylesheet" href="/src/styles/responsive.css" />
    </head>
    <body>
        <div class="app">
            <aside class="sidebar">
                <div class="brand">
                    <h1>CodexManager</h1>
                    <span>Codex 兼容 · 号池管理</span>
                </div>
                <div class="nav">
                    <button id="navDashboard" class="active">仪表盘</button>
                    <button id="navAccounts">账号管理</button>
                    <button id="navApiKeys">平台 Key</button>
                </div>
            </aside>

            <main class="content">
                <div class="topbar">
                    <div class="topbar-title">
                        <h2 id="pageTitle">仪表盘</h2>
                        <span>可用状态与用量概览</span>
                    </div>
                    <div class="actions">
                        <div class="service-setup">
                            <input
                                id="serviceAddr"
                                type="text"
                                placeholder="端口，如 5050"
                            />
                            <button id="serviceToggle" class="secondary">
                                启动服务
                            </button>
                        </div>
                        <div class="service-meta">
                            <div id="status" class="status-pill">未启动</div>
                            <div id="serviceHint" class="hint"></div>
                        </div>
                        <button id="globalRefresh" class="secondary">
                            刷新数据
                        </button>
                    </div>
                </div>

                <section id="pageDashboard" class="page active">
                    <div class="grid dashboard-metrics">
                        <div class="card">
                            <h3>可用账号</h3>
                            <div class="metrics" id="metricAvailable">0</div>
                            <div class="metric-sub">当前可用</div>
                        </div>
                        <div class="card">
                            <h3>不可用账号</h3>
                            <div class="metrics" id="metricUnavailable">0</div>
                            <div class="metric-sub">额度用尽/不可用</div>
                        </div>
                    </div>

                    <div class="grid dashboard-panels">
                        <div class="panel">
                            <div class="panel-header">
                                <h3>状态分布</h3>
                                <span class="hint" id="statusUpdated"
                                    >最近刷新: --</span
                                >
                            </div>
                            <div class="donut">
                                <div id="statusDonut" class="donut-ring"></div>
                                <div class="donut-legend">
                                    <div class="legend-item">
                                        <span
                                            class="legend-dot legend-ok"
                                        ></span
                                        >可用 <span id="legendOk">0</span>
                                    </div>
                                    <div class="legend-item">
                                        <span
                                            class="legend-dot legend-warn"
                                        ></span
                                        >告警 <span id="legendWarn">0</span>
                                    </div>
                                    <div class="legend-item">
                                        <span
                                            class="legend-dot legend-bad"
                                        ></span
                                        >不可用 <span id="legendBad">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <h3>用量</h3>
                                <span class="hint">按账号</span>
                            </div>
                            <div id="usageBars" class="usage-table"></div>
                        </div>
                    </div>
                </section>

                <section id="pageAccounts" class="page">
                    <div class="panel">
                        <div class="panel-header">
                            <div>
                                <h3>账号管理</h3>
                                <p>
                                    一行一账号，支持备注/标签/分组与用量查询。
                                </p>
                            </div>
                            <button id="addAccount">新增账号</button>
                        </div>

                        <div class="table table-header account-table">
                            <div>账号</div>
                            <div>分组</div>
                            <div>标签</div>
                            <div>顺序</div>
                            <div>可用状态</div>
                            <div>最近刷新</div>
                            <div>操作</div>
                        </div>
                        <div id="accountRows" class="table account-table"></div>
                    </div>
                </section>

                <section id="pageApiKeys" class="page">
                    <div class="panel">
                        <div class="panel-header">
                            <div>
                                <h3>平台 Key</h3>
                                <p>创建/管理网关调用所需的 Key</p>
                            </div>
                            <button id="createApiKey" class="secondary">
                                创建 Key
                            </button>
                        </div>
                        <div class="table table-header api-table">
                            <div>Key ID</div>
                            <div>名称</div>
                            <div>状态</div>
                            <div>最近使用</div>
                            <div>操作</div>
                        </div>
                        <div class="table api-table" id="apiKeyRows"></div>
                    </div>
                </section>
            </main>
        </div>
        <div id="modalAccount" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3>新增账号</h3>
                    <button id="closeAccountModal" class="ghost">关闭</button>
                </div>
                <div class="modal-body">
                    <label>标签（逗号分隔）</label>
                    <input id="inputTags" placeholder="例如：高频, 团队A" />
                    <label>备注/描述</label>
                    <input id="inputNote" placeholder="例如：主号 / 测试号" />
                    <label>分组</label>
                    <select id="inputGroup">
                        <option value="">请选择</option>
                        <option value="TEAM">TEAM</option>
                        <option value="PERSONAL">PERSONAL</option>
                    </select>
                    <div id="loginHint" class="hint">
                        点击登录后会打开浏览器完成授权。
                    </div>
                    <div class="login-url">
                        <input id="loginUrl" class="mono" readonly value="" />
                        <button id="copyLoginUrl" class="secondary">
                            复制链接
                        </button>
                    </div>
                    <label>回调链接（端口占用时可手动解析）</label>
                    <div class="login-url">
                        <input
                            id="manualCallbackUrl"
                            class="mono"
                            placeholder="粘贴回调链接"
                        />
                        <button id="manualCallbackSubmit" class="secondary">
                            解析回调
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="submitLogin">登录授权</button>
                    <button id="cancelLogin" class="secondary">取消</button>
                </div>
            </div>
        </div>

        <div id="modalUsage" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3 id="usageTitle">用量查询</h3>
                    <button id="closeUsageModal" class="ghost">关闭</button>
                </div>
                <div class="modal-body">
                    <div id="usageProgress" class="progress"></div>
                    <div id="usageDetail" class="hint">等待刷新...</div>
                </div>
                <div class="modal-footer">
                    <button id="refreshUsageSingle">刷新用量</button>
                </div>
            </div>
        </div>

        <div id="modalApiKey" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3>创建平台 Key</h3>
                    <button id="closeApiKeyModal" class="ghost">关闭</button>
                </div>
                <div class="modal-body">
                    <label>名称（可选）</label>
                    <input
                        id="inputApiKeyName"
                        placeholder="例如：主机房 / 测试"
                    />
                    <label>平台 Key</label>
                    <div class="login-url">
                        <input
                            id="apiKeyValue"
                            class="mono"
                            readonly
                            value=""
                        />
                        <button id="copyApiKey" class="secondary">
                            复制Key
                        </button>
                    </div>
                    <div class="hint">Key 仅创建时显示，请妥善保存。</div>
                </div>
                <div class="modal-footer">
                    <button id="submitApiKey">生成Key</button>
                    <button id="cancelApiKey" class="secondary">取消</button>
                </div>
            </div>
        </div>

        <script type="module" src="/src/main.js"></script>
    </body>
</html>
